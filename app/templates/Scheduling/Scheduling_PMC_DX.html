<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>定型预排生管排单</title>
    <link rel="stylesheet" href=" {{url_for('static',filename='bootstrap/css/bootstrap.css')}} ">
    <link rel="stylesheet" href=" {{url_for('static',filename='bootstrap/css/bootstrap.min.css')}} ">
    <link rel="stylesheet" href=" {{url_for('static',filename='Scheduling/css/dragslot.css')}} ">
    <!-- <link rel="stylesheet" href=" {{url_for('static',filename='Scheduling/css/bootstrap_var.css')}} "> -->
    <link rel="stylesheet" href=" {{url_for('static',filename='Scheduling/css/Scheduling_PMC.css')}} ">
    <style type="text/css">
        .currentli {
            color: #186ecc;
            font-weight: 700;
        }

        .currentTitle {
            color: #000;
        }
    </style>
</head>

<body id="body">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand"
                    href=" {{ url_for('Scheduling.PMCIndex', sWorkingProcedureName = '预定' ) }} ">预定</a>
                <a class="navbar-brand"
                    href=" {{ url_for('Scheduling.PMCIndex', sWorkingProcedureName = '水洗1' ) }} ">水洗1</a>
                <a class="navbar-brand"
                    href=" {{ url_for('Scheduling.PMCIndex', sWorkingProcedureName = '水洗2' ) }} ">水洗2</a>
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li class=""><a href="#">更新数据<span class="sr-only"></span></a></li>
                    <li><a href="#" onclick="GetLabel()">标记特急</a></li>
                    <li><a href="#" onclick="LossLabel()">取消特急</a></li>
                    <li><a href="#" onclick="DeleteLabelData()">取消预排</a></li>
                    <li><a href="#" onclick="unCheck('up')">取消选中</a></li>
                    <li><a>|</a></li>
                    <li><a href="#" onclick="CheckScheduling()">标记预排</a></li>
                    <li><a href="#" onclick="unCheck('down')">取消选中</a></li>
                    <li><a>|</a></li>
                    <li><a href="#" onclick="btnRemark()">说明</a></li>
                </ul>
                <div class="navbar-form navbar-left">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="卡号" id="sSearchInput">
                    </div>
                    <button type="" class="btn btn-default" name="btnup" onclick="SearchInput('btnup')">搜索上方数据</button>
                    <button type="" class="btn btn-default" name="btndown"
                        onclick="SearchInput('btndown')">搜索下方数据</button>
                </div>
            </div>
        </div>
    </nav>
    <div class="main_var">
        <div class="outer_div">
            <div class="htmleaf-container">
                <div style="height: 50px; text-align: center;">
                    <table class="table" style="position: fixed;">
                        <tr style="background-color:#EEE0E5;">
                            <td style="width: 8%; line-height: 25px;" class="border-left">卡号</td>
                            <td style="width: 8%; line-height: 25px;" class="border-left">物料编号</td>
                            <td style="width: 3%; line-height: 25px;" class="border-left">LOT</td>
                            <td style="width: 10%; line-height: 25px;" class="border-left">色号</td>
                            <td style="width: 5%; line-height: 25px;" class="border-left">实际投胚</td>
                            <td style="width: 6%; line-height: 25px;" class="border-left">当前工段</td>
                            <td style="width: 10%; line-height: 25px;" class="border-left">上工段完成时间</td>
                            <!-- <td style="width: 5%; line-height: 25px;" class="border-left">退卷耗时</td> -->
                            <td style="width: 5%; line-height: 25px;" class="border-left">预定耗时</td>
                            <td style="width: 15%; line-height: 25px;" class="border-left">客户名称</td>
                            <td style="width: 6%; line-height: 25px;" class="border-left">业务员</td>
                            <td style="width: 8%; line-height: 25px;" class="border-left">营业课别</td>
                            <td style="width: 6%; line-height: 25px;" class="border-left">布车号</td>
                            <td style="width: 2%; line-height: 25px;" class="border-left"></td>
                        </tr>
                    </table>
                </div>
                <form action="" method="POST">
                    <section class="">
                        <div id="dragslot" class="">
                            <div class="top-div" id="top-div" style="overflow-y:scroll;">
                                <ul id="" class="" style="margin: 0;padding: 0;">
                                    {% for i in SchedulingZL_PMCDataHDR %}
                                    <li class="slot-item height40 marginLeft40"
                                        style="padding: 0; background-color: {{i.sLabel}}">
                                        <div class="clearfix height40">
                                            <div class="hover_PMC" style="width:100%;">
                                                <table class="table">
                                                    <tr>
                                                        <td style="width: 8%; line-height: 25px;">{{i.sCardNo}}</td>
                                                        <td style="width: 8%; line-height: 25px;" class="border-left">
                                                            {{i.sMaterialNo}}</td>
                                                        <td style="width: 3%; line-height: 25px;" class="border-left">
                                                            {{i.sMaterialLot}}</td>
                                                        <td style="width: 10%; line-height: 25px;" class="border-left">
                                                            {{i.sColorNo}}</td>
                                                        <td style="width: 5%; line-height: 25px;" class="border-left">
                                                            {{i.nFactInputQty}}</td>
                                                        <td style="width: 6%; line-height: 25px;" class="border-left">
                                                            {{i.sWorkingProcedureNameCurrent}}</td>
                                                        <td style="width: 10%; line-height: 25px;" class="border-left">
                                                            {{i.tFactEndTimeLast }}</td>
                                                        <!-- <td style="width: 5%; line-height: 25px;" class="border-left">
                                                            {{i.nTJTime}}</td> -->
                                                        <td style="width: 5%; line-height: 25px;" class="border-left">
                                                            {{i.nPSTime}}</td>
                                                        <td style="width: 15%; line-height: 25px;" class="border-left">
                                                            {{i.sCustomerName}}</td>
                                                        <td style="width: 6%; line-height: 25px;" class="border-left">
                                                            {{i.sSalesName}}</td>
                                                        <td style="width: 8%; line-height: 25px;" class="border-left">
                                                            {{i.sSalesGroupName}}</td>
                                                        <td style="width: 6%; line-height: 25px;" class="border-left">
                                                            {{i.sLocation}}</td>
                                                        <td style="width: 1%; line-height: 25px;" class="border-left">
                                                        </td>
                                                        <td hidden>{{i.nOverTime}}</td>
                                                        <td hidden>{{i.uppTrackJobGUID}}</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div style="background-color:#000; height:5px;"></div>
                            <div class="bottom-div" id="bottom-div" style="overflow-y:scroll;" style="position: fixed;">
                                <!-- <div id="section_var_PMC2" class="section_var_PMC2" style="overflow-y:scroll;"> -->
                                <ul id="" class="" style="margin: 0;padding: 0;">
                                    <!-- <div style="margin-top: 30px;" style="position: fixed;"> -->
                                    {% for i in SchedulingZL_PMCData %}
                                    <li class="slot-item height40 marginLeft40" style="padding: 0; background-color: {{i.sIsRush}}">
                                        <div class="clearfix height40">
                                            <div class="hover_PMC" style="width:100%;">
                                                <table class="table">
                                                    <tr>
                                                        <td style="width: 8%; line-height: 25px;">{{i.sCardNo}}
                                                        </td>
                                                        <td style="width: 8%; line-height: 25px;" class="border-left">
                                                            {{i.sMaterialNo}}</td>
                                                        <td style="width: 3%; line-height: 25px;" class="border-left">
                                                            {{i.sMaterialLot}}</td>
                                                        <td style="width: 10%; line-height: 25px;" class="border-left">
                                                            {{i.sColorNo}}</td>
                                                        <td style="width: 5%; line-height: 25px;" class="border-left">
                                                            {{i.nFactInputQty}}</td>
                                                        <td style="width: 6%; line-height: 25px;" class="border-left">
                                                            {{i.sWorkingProcedureNameCurrent}}</td>
                                                        <td style="width: 10%; line-height: 25px;" class="border-left">
                                                            {{i.tFactEndTimeLast }}</td>
                                                        <!-- <td style="width: 5%; line-height: 25px;" class="border-left">
                                                            {{i.nTJTime}}</td> -->
                                                        <td style="width: 5%; line-height: 25px;" class="border-left">
                                                            {{i.nPSTime}}</td>
                                                        <td style="width: 15%; line-height: 25px;" class="border-left">
                                                            {{i.sCustomerName}}</td>
                                                        <td style="width: 6%; line-height: 25px;" class="border-left">
                                                            {{i.sSalesName}}</td>
                                                        <td style="width: 8%; line-height: 25px;" class="border-left">
                                                            {{i.sSalesGroupName}}</td>
                                                        <td style="width: 6%; line-height: 25px;" class="border-left">
                                                            {{i.sLocation}}</td>
                                                        <td style="width: 1%; line-height: 25px;" class="border-left">
                                                        </td>
                                                        <td hidden>{{i.nOverTime}}</td>
                                                        <td hidden>{{i.uppTrackJobGUID}}</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                    </li>
                                    {% endfor %}
                                    <!-- </div> -->
                                </ul>
                                <!-- </div> -->
                            </div>
                        </div>
                    </section>
                </form>
            </div>
        </div>
    </div>

    <script src="http://cdn.bootcss.com/jquery/1.11.0/jquery.min.js" type="text/javascript"></script>
    <script>
        window.jQuery || document.write('<script src="../static/Scheduling/js/jquery-1.11.0.min.js"><\/script>')
    </script>
    <script type="text/javascript" src="/static/Scheduling/js/dragslot-PMC.js"></script>

    <script>
        var GetCurrentWork = function () {
            var ThisLink = document.URL;
            var Working = ThisLink.split('/')[5];
            var ThisWorking = '';
            if (Working == '%E9%A2%84%E5%AE%9A' || Working == '%E9%A2%84%E5%AE%9A#') {
                ThisWorking = '预定';
                // console.log('预定');
            } else if (Working == '%E6%B0%B4%E6%B4%971' || Working == '%E6%B0%B4%E6%B4%971#') {
                ThisWorking = '水洗1';
                // console.log('水洗1');
            } else if (Working == '%E6%B0%B4%E6%B4%972' || Working == '%E6%B0%B4%E6%B4%972#') {
                ThisWorking = '水洗2';
                // console.log('水洗2');
            }
            return ThisWorking
        }
    </script>


    <script>
        // ClassName
        var _$ = function (id) {
            return document.getElementsByClassName(id);
        }

        // ID
        var $$ = function (id) {
            return document.getElementById(id);
        }

        // Name
        var __$ = function (id) {
            return document.getElementsByName(id);
        }

        // 尺寸修改
        var getScreen = function () {
            var nWidth = document.body.clientWidth;
            var nHeight = document.documentElement.clientHeight;
            var content = $$('body');
            console.log(nWidth);
            console.log(nHeight);
            $$('top-div').style.height = (nHeight / 2) - 100 + 'px';
            $$('bottom-div').style.height = (nHeight / 2) - 30 + 'px';
            $$('top-div').style.nWidth = nWidth + 'px';
            $$('dragslot').style.nWidth = nWidth + 'px';
            $$('dragslot').style.height = nHeight - 110 + 'px';
            content.style.width = nWidth + 'px';
            content.style.height = nHeight - 5 + 'px';
            console.log('getScreen');
        }

        // 页面初始
        window.onload = function () {
            getScreen();
            // fullScreen();
        }

        // 修改屏幕尺寸后进行div的更新
        window.onresize = function () {
            getScreen();
        }
    </script>

    <script>
        jQuery(function ($) {
            $('#dragslot').dragslot({
                dropCallback: function (el) {
                    //	alert(el);
                }
            });
        });
    </script>

    <script>
        // AJAX页面信息
        var AjaxPage = function () {
            ThisWork = GetCurrentWork();
            $('#dragslot').load('ZL/AJAX/UpdatePage/' + ThisWork);
        }

        // 取消上部分选中 // top-div      
        var unCheck = function (UpOrDown) {
            var topli = ''
            if (UpOrDown == 'up') {
                topli = $$('top-div').children[0].children;
            } else if (UpOrDown == 'down') {
                topli = $$('bottom-div').children[0].children;
            }
            for (var i = 0; i < topli.length; i++) {
                console.log(topli[i]);
                topli[i].classList.remove("currentli");
            }
        }

        // 标记特急件
        var GetLabel = function () {
            var topli = $$('top-div').children[0].children;
            for (var i = 0; i < topli.length; i++) {
                var iFlag = 0
                var classListVar = topli[i].classList;
                for (var a = 0; a < classListVar.length; a++) {
                    if (classListVar[a] == 'currentli') {
                        iFlag = 1;
                        break;
                    }
                }
                if (iFlag == 1) {
                    var ReturnList = [];
                    var CheckLabel = topli[i].children[0].children[0].children[0].children[0].children[0].children[
                        14].innerHTML;
                    // UpdateLabel_PMC(CheckLabel);
                    VarDict = {
                        'uppTrackJobGUID': CheckLabel,
                    }
                    ReturnList.push(VarDict);

                    $.ajax({
                        type: 'POST',
                        url: 'ZL/AJAX/Label/True',
                        data: JSON.stringify(ReturnList),
                        contentType: 'application/json; charset=UTF-8',
                        dataType: 'json',
                        success: function (data) {},
                    });
                    AjaxPage();
                }
            }
        }

        // 取消特急件标记
        var LossLabel = function () {
            var topli = $$('top-div').children[0].children;
            for (var i = 0; i < topli.length; i++) {
                var iFlag = 0
                var classListVar = topli[i].classList;
                for (var a = 0; a < classListVar.length; a++) {
                    if (classListVar[a] == 'currentli') {
                        iFlag = 1;
                        break;
                    }
                }
                if (iFlag == 1) {
                    var ReturnList = [];
                    var CheckLabel = topli[i].children[0].children[0].children[0].children[0].children[0].children[
                        14].innerHTML;
                    // UpdateLabel_PMC(CheckLabel);
                    VarDict = {
                        'uppTrackJobGUID': CheckLabel,
                    }

                    ReturnList.push(VarDict);

                    $.ajax({
                        type: 'POST',
                        url: 'ZL/AJAX/Label/False',
                        data: JSON.stringify(ReturnList),
                        contentType: 'application/json; charset=UTF-8',
                        dataType: 'json',
                        success: function (data) {},
                    });
                    AjaxPage();
                }
            }
        }

        // 删除数据
        var DeleteLabelData = function () {
            var topli = $$('top-div').children[0].children;
            for (var i = 0; i < topli.length; i++) {
                var iFlag = 0
                var classListVar = topli[i].classList;
                for (var a = 0; a < classListVar.length; a++) {
                    if (classListVar[a] == 'currentli') {
                        iFlag = 1;
                        break;
                    }
                }

                if (iFlag == 1) {
                    var ReturnList = [];
                    var CheckLabel = topli[i].children[0].children[0].children[0].children[0].children[0].children[
                        14].innerHTML;
                    // UpdateLabel_PMC(CheckLabel);
                    VarDict = {
                        'uppTrackJobGUID': CheckLabel,
                    }

                    ReturnList.push(VarDict);

                    $.ajax({
                        type: 'POST',
                        url: 'ZL/AJAX/delete',
                        data: JSON.stringify(ReturnList),
                        contentType: 'application/json; charset=UTF-8',
                        dataType: 'json',
                        success: function (data) {},
                    });
                }
            }
            AjaxPage();

        }

        // 下部数据上移
        var CheckScheduling = function () {
            var bottomli = $$('bottom-div').children[0].children;
            var Working = GetCurrentWork();
            console.log(bottomli)
            var returnList = [];
            for (var i = 0; i < bottomli.length; i++) {
                // console.log(returnList);
                var liClassList = bottomli[i].classList;
                console.log(liClassList);
                // console.log(liClassList);
                for (var a = 0; a <= liClassList.length; a++) {
                    if (liClassList[a] == 'currentli') {
                        var uppTrackJobGUID = bottomli[i].children[0].children[0].children[0].children[0].children[
                            0].children[14].innerHTML;
                        var varDict = {
                            'sType': Working,
                            'uppTrackJobGUID': uppTrackJobGUID
                        }
                        returnList.push(varDict);
                        // console.log(returnList);
                        // break;
                    }
                }
            }
            console.log(returnList);
            $.ajax({
                type: 'POST',
                url: 'ZL/AJAX/DataUpdate/ + Working',
                data: JSON.stringify(returnList),
                contentType: 'application/json; charset=UTF-8',
                dataType: 'json',
                success: function (data) {},
            });
            console.log('------------------')
            AjaxPage();
        }
    </script>

    <script>
        var SearchInput = function (sVar) {
            // 搜索按钮事件
            var ThisWorking = GetCurrentWork();
            var inputVar = $$('sSearchInput').value;
            var dragslot = ''
            if (sVar == 'btnup') {
                dragslot = $$('dragslot').children[0];
            } else if (sVar = 'btndown') {
                dragslot = $$('dragslot').children[2];
            }

            var LiList = dragslot.children[0].children;

            var iFlag = 0
            for (var i = 0; i < LiList.length; i++) {
                var tdList = LiList[i].children[0].children[0].children[0].children[0].children[0].children;

                // 清空选中
                var LiClassName = LiList[i].className;
                if (LiClassName.search('currentli') != -1) {
                    LiList[i].className = 'slot-item height40';
                }

                // 遍历td,寻找值
                for (var a = 0; a < tdList.length; a++) {
                    var tdValue = tdList[a].innerHTML.replace(/\s*/g, "");;
                    if (tdValue.search(inputVar) != -1) {
                        var TopHeight = document.getElementById('top-div').offsetHeight;
                        var LiHeight = LiList[i].offsetHeight;
                        var nDiff = (TopHeight / LiHeight) / 2;
                        var slow = (i - nDiff) * 40;
                        var LiClassList = LiList[i].className;
                        LiClassList += ' currentli';
                        LiList[i].className = LiClassList;
                        dragslot.scrollTop = slow;
                        iFlag = 1;
                    }
                }
            }
            returnValue = inputVar + '_' + ThisWorking;
            console.log(returnValue);
            // 查找其他的卡号
            if (iFlag == 0 && sVar == 'btndown') {
                console.log(returnValue);
                console.log('-------------------------');

                $('#bottom-div').load('ZL/AJAX/Search/' + returnValue);
            }
        }
    </script>

    <script>
        var btnRemark = function () {
            var url = "http://198.168.6.56:5000/Scheduling/PMC/ZL/Remark";
            window.open(url, '说明','height=400, width=320, top=270%, left=600%')
        
        }
    </script>

</body>

</html>