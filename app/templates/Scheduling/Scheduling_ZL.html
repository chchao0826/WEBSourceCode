<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>整理课排单</title>
    <link rel="stylesheet" href=" {{url_for('static',filename='bootstrap/css/bootstrap.css')}} ">
    <link rel="stylesheet" href=" {{url_for('static',filename='bootstrap/css/bootstrap-theme.css')}} ">
    <link rel="stylesheet" href=" {{url_for('static',filename='bootstrap/css/bootstrap-theme.min.css')}} ">
    <link rel="stylesheet" href=" {{url_for('static',filename='Scheduling/css/dragslot.css')}} ">
    <!-- <link rel="stylesheet" href=" {{url_for('static',filename='Scheduling/css/bootstrap_var.css')}} "> -->
    <link rel="stylesheet" href=" {{url_for('static',filename='Scheduling/css/Scheduling-ZL.css')}} ">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <style type="text/css">
        .currentli {
            color: #186ecc;
            font-size: 15px;
            font-weight: 700;
        }
    </style>
</head>

<body id="body" class="">
    <div class="left-div float-left">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand"
                        href=" {{ url_for('Scheduling.DXindex', sWorkingProcedureName = '预定' ) }} ">预定</a>
                    <a class="navbar-brand"
                        href=" {{ url_for('Scheduling.DXindex', sWorkingProcedureName = '成定' ) }} ">成定</a>
                </div>
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li><a href="#" onclick="">更新数据<span class="sr-only"></span></a></li>
                    </ul>
                    <div class="navbar-form navbar-left">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="卡号" id="sSearchInput">
                        </div>
                        <button type="" class="btn btn-default" name="btnup" style="margin-top: 0px;"
                            onclick="SearchInput('btnup')">搜索上方数据</button>
                    </div>
                </div>
            </div>
        </nav>
        <div style="overflow-y:scroll; ">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th style="width: 10%;">卡号</th>
                        <th style="width: 10%;">布种</th>
                        <th style="width: 10%;">颜色</th>
                        <th style="width: 10%;">幅宽</th>
                        <th style="width: 10%;">克重</th>
                        <th style="width: 10%;">投胚</th>
                        <th style="width: 10%;">预计时间</th>
                        <th style="width: 10%;">温度</th>
                        <th style="width: 10%;">速度</th>
                        <th style="width: 10%;">当前工段</th>
                    </tr>
                </thead>
            </table>
        </div>
        <div class="table-style" style="overflow-y:scroll; overflow-x:scroll; margin-top: -21px;">
            <table class="table table-bordered" id="dataTable">
                {% for i in ReturnData %}
                <tr onclick="onclicktr('{{i['uppTrackJobGUID']}}')" id="{{i['uppTrackJobGUID']}}">
                    <td style="width: 10%;">{{i['sCardNo']}}</td>
                    <td style="width: 10%;">{{i['sMaterialNo']}}</td>
                    <td style="width: 10%;">{{i['sColorNo']}}</td>
                    <td style="width: 10%;">{{i['sProductWidth']}}</td>
                    <td style="width: 10%;">{{i['sProductGMWT']}}</td>
                    <td style="width: 10%;">{{i['nFactInPutQty']}}</td>
                    <td style="width: 10%;">{{i['nTime']}}</td>
                    <td style="width: 10%;">{{i['nTemp']}}</td>
                    <td style="width: 10%;">{{i['nSpeed']}}</td>
                    <td style="width: 10%;">{{i['sWorkingProcedureName']}}</td>
                    <td hidden>{{i['uppTrackJobGUID']}}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
    <div class="mid-div float-left" style="text-align: center; height:300px; margin-top: 60px;">
        <button type="button" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-arrow-up"
                aria-hidden="true"></span></button>
        <button type="button" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-arrow-down"
                aria-hidden="true"></span></button>
        <button type="button" class="btn btn-default btn-lg" onclick="AJAXInsertData()"><span
                class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span></button>
        <button type="button" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-arrow-left"
                aria-hidden="true"></span></button>
        <button type="button" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-eject"
                aria-hidden="true"></span></button>
        <button type="button" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-refresh"
                aria-hidden="true"></span></button>

    </div>
    <div class="right-div float-left">
        <div style="height: 80px;">
            <ul class="nav nav-pills" id="eqLi">
                {% for i in ReturnEquipment %}
                <li role="presentation"><a href="#" onclick="onclickCurrentli('{{i['ID']}}')"
                        id="{{i['ID']}}">{{i['sEquipmentNo']}}</a></li>
                {% endfor %}
            </ul>
        </div>
        <div id="DataDiv">
            {% for i in ReturnDtlData %}
            <div class="div-card">
                <div class="float-left"
                    style="width: 200px; border-right: 1px solid #111; height: 100%; text-align: center; line-height: 55px; text-align: center; line-height: 60px;">
                    <span>{{i['sCardNo']}}</span>
                </div>
                <div class="float-left">
                    <div
                        style="border-bottom: 1px solid #111; height: 30px; width: 157px; text-align: center; line-height: 30px;">
                        <span>{{i['sMaterialNo']}}</span>
                    </div>
                    <div style="text-align: center; line-height: 30px;">
                        <span>{{i['nTime']}}</span>
                    </div>
                </div>
                <div class="float-left" style="width: 21px; height:58px; background-color:#111; text-align: center;">
                </div>
                <div hidden>{{i['uppTrackJobGUID']}}</div>
            </div>
            {% endfor %}
        </div>
    </div>

    <script src="http://cdn.bootcss.com/jquery/1.11.0/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="/static/Scheduling/js/dragslot.js"></script>

    <script>
        // ClassName
        var _$ = function (id) {
            return document.getElementsByClassName(id);
        }

        // ID
        var $$ = function (id) {
            return document.getElementById(id);
        }

        // Name
        var __$ = function (id) {
            return document.getElementsByName(id);
        }

        // 尺寸修改
        var getScreen = function () {
            var nWidth = document.body.clientWidth;
            var nHeight = document.documentElement.clientHeight;
            var content = $$('body');
            content.style.width = nWidth + 'px';
            content.style.height = nHeight - 50 + 'px';
        }

        // 页面初始
        window.onload = function () {
            getScreen();
            // fullScreen();
        }

        // 修改屏幕尺寸后进行div的更新
        window.onresize = function () {
            getScreen();
        }
    </script>

    <script>
        var GetDate = function () {
            var day2 = new Date();
            var sYear = day2.getFullYear();
            var sMonth = day2.getMonth() + 1;
            var sDate = day2.getDate();
            if ((sMonth.toString().length) == 1) {
                sMonth = '0' + sMonth.toString()
            }
            if ((sDate.toString().length) == 1) {
                sDate = '0' + sDate.toString()
            }
            var dateTime = sYear + "-" + sMonth + "-" + sDate;
            return dateTime
        }
    </script>


    <script>
        // 点击table tr 后增加选中效果
        var onclicktr = function (trVar) {
            var trValue = $$(trVar);
            var trClass = trValue.classList;
            if (trClass == 'currentli') {
                trValue.classList = '';
            } else {
                trValue.classList = 'currentli';
            }
        }

        // 选择机台后执行AJAX 刷新右边数据
        var onclickCurrentli = function (LiVar) {
            var LiList = $$(LiVar).parentNode.parentNode.children
            for (var i = 0; i < LiList.length; i++) {
                LiList[i].classList = ''
            }
            $$(LiVar).parentNode.classList = 'active'
            $('#DataDiv').load('AJAXDtl/' + LiVar);
        }

        // 转移的数据+原有的数据 返回
        var GetCurrentLi = function () {
            var sDateTime = GetDate()
            var ThisEq = $$('eqLi').children;
            var EqVar = ''
            for (var i = 0; i < ThisEq.length; i++) {
                if (ThisEq[i].classList == 'active') {
                    EqVar = ThisEq[i].children[0].id;
                }
            }
            if (EqVar == '') {
                alert('未选择机台号');
            }
            var trList = $$('dataTable').children[0].children;
            var DtlList = $$('DataDiv').children;
            var returnList = []
            var nRow = 0;
            for (var i = 0; i < DtlList.length; i++) {
                var uppTrackJobGUID = DtlList[i].children[3].innerHTML;
                var sDict = {
                    'nHDRID': EqVar,
                    'uppTrackJobGUID': uppTrackJobGUID,
                    'nRowNumber': i,
                    'tTime': sDateTime,
                }
                nRow = i;
            }

            for (var i = 0; i < trList.length; i++) {
                if (trList[i].classList == 'currentli') {
                    var uppTrackJobGUID = trList[i].children[10].innerHTML;
                    var sdict = {
                        'nHDRID': EqVar,
                        'uppTrackJobGUID': uppTrackJobGUID,
                        'nRowNumber': nRow + i,
                        'tTime': sDateTime,
                    }
                    returnList.push(sdict)
                }
                // console.log(trList[i].classList);
            }
            console.log(returnList)
            return returnList
        }

        // 删除选中的数据
        var DeleteCurrentLi = function() {
            var trHTML = ''
            var trList = $$('dataTable').children[0].children;
            for (var i = 0; i < trList.length; i++){
                var trClass = trList[i].classList;
                if (trClass != 'currentli'){
                    trHTML += trList[i].outerHTML
                }
            }
            $$('dataTable').innerHTML = trHTML;
        }

        // AJAX插入数据
        var AJAXInsertData = function () {
            var InserData = GetCurrentLi();
            var sEqID = InserData[0]['nHDRID'];
            console.log(InserData);
            $.ajax({
                type: 'POST',
                url: 'AJAXInsertData',
                data: JSON.stringify(InserData),
                contentType: 'application/json; charset=UTF-8',
                dataType: 'json',
                success: function (data) {
                },
            });
            onclickCurrentli(sEqID);
            DeleteCurrentLi();
        }
    
    
    
    </script>


</body>

</html>